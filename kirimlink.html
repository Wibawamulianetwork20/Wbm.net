<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kirim Link Pembayaran</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body class="bg-light">

<div class="container py-5">
  <h3 class="text-center mb-4">Kirim Link Pembayaran ke Pelanggan</h3>

  <div id="daftarPelanggan" class="table-responsive">
    <table class="table table-bordered table-striped">
      <thead>
        <tr>
          <th>Nama</th>
          <th>Paket</th>
          <th>Harga</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody id="tabelBody"></tbody>
    </table>
  </div>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBXnXCSXhy06eqWBPzYmzxCo_LBzl51DO4",
  authDomain: "wibawamulianetwork.firebaseapp.com",
  databaseURL: "https://wibawamulianetwork-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "wibawamulianetwork",
  storageBucket: "wibawamulianetwork.firebasestorage.app",
  messagingSenderId: "605020393823",
  appId: "1:605020393823:web:6ba8afe7e250bc004da6ea",
  measurementId: "G-9EWJE8F5FG"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const tabelBody = document.getElementById("tabelBody");

  db.ref("pelanggan").once("value").then(snapshot => {
    snapshot.forEach(child => {
      const id = child.key;
      const data = child.val();

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${data.nama}</td>
        <td>${data.paket}</td>
        <td>Rp ${Number(data.harga).toLocaleString()}</td>
        <td>
          <button class="btn btn-success btn-sm" onclick="kirimWhatsApp('${id}', '${data.nama}')">
            Kirim via WA
          </button>
        </td>
      `;
      tabelBody.appendChild(tr);
    });
  });

  function kirimWhatsApp(id, nama) {
    const linkPembayaran = `https://namadomain.com/pembayaran.html?id=${id}`;
    const pesan = `Halo ${nama}, silakan bayar tagihan internet Anda melalui link berikut:\n\n${linkPembayaran}`;
    const noAdmin = "6285817230536"; // ganti dengan no admin yang kirim link
    const waURL = `https://wa.me/${noAdmin}?text=${encodeURIComponent(pesan)}`;
    window.open(waURL, "_blank");
  }
</script>
</body>
</html>