<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>e-Billing System - Pemasukan</title>
  <link rel="stylesheet" href="pemasukan.css" />
</head>
<body>

  <h1>Dashboard Pemasukan</h1>

  <table>
    <thead>
      <tr>
        <th>No</th>
        <th>Kategori</th>
        <th>Harga</th>
        <th>Metode</th>
      </tr>
    </thead>
    <tbody id="tabelPemasukan"></tbody>
  </table>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBXnXCSXhy06eqWBPzYmzxCo_LBzl51DO4",
      authDomain: "wibawamulianetwork.firebaseapp.com",
      databaseURL: "https://wibawamulianetwork-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "wibawamulianetwork",
      storageBucket: "wibawamulianetwork.appspot.com",
      messagingSenderId: "605020393823",
      appId: "1:605020393823:web:6ba8afe7e250bc004da6ea"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    db.ref('pemasukan').once('value').then(snapshot => {
  let total = 0;
  let langgananCash = 0;
  let langgananTransfer = 0;
  let no = 1;
  const tbody = document.getElementById("tabelPemasukan");
  tbody.innerHTML = "";  // Clear table before loading data

  if (!snapshot.exists()) {
    tbody.innerHTML = "<tr><td colspan='4'>Tidak ada data pemasukan</td></tr>";
    document.getElementById("totalPemasukan").innerText = "Rp 0";
    document.getElementById("langgananCash").innerText = "Rp 0";
    document.getElementById("langgananTransfer").innerText = "Rp 0";
    return;  // Exit if no data
  }

  snapshot.forEach(child => {
    const data = child.val();
    const harga = parseInt(data.harga) || 0;
    const metode = (data.metode || "-").toLowerCase();
    const kategori = (data.kategori || "-").toLowerCase();

    total += harga;

    if (kategori.includes('langganan')) {
      if (metode.includes('tunai') || metode.includes('cash')) {
        langgananCash += harga;
      } else if (metode.includes('transfer')) {
        langgananTransfer += harga;
      }
    }

    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${no++}</td>
      <td>${kategori}</td>
      <td>Rp ${harga.toLocaleString()}</td>
      <td>${metode}</td>
    `;
    tbody.appendChild(row);
  });

  document.getElementById("totalPemasukan").innerText = "Rp " + total.toLocaleString();
  document.getElementById("langgananCash").innerText = "Rp " + langgananCash.toLocaleString();
  document.getElementById("langgananTransfer").innerText = "Rp " + langgananTransfer.toLocaleString();
});
  </script>

</body>
</html>
